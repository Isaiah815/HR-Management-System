<div class="attendance-container">
  <h2>{{ isEditing ? 'Edit Attendance Record' : 'Add New Attendance' }}</h2>

  <form (ngSubmit)="saveAttendance()" class="attendance-form">
    <div class="form-row">

      <div class="form-group">
        <label for="employeeId">Employee ID</label>
        <input
          type="number"
          id="employeeId"
          [(ngModel)]="currentAttendance.employeeId"
          name="employeeId"
          placeholder="Enter employee ID"
          required
        />
      </div>

      <div class="form-group">
        <label for="status">Status</label>
        <select
          id="status"
          [(ngModel)]="currentAttendance.status"
          name="status"
          (change)="onStatusChange()"
          required
        >
          <option value="">Select status</option>
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
          <option value="Leave">Leave</option>
        </select>
      </div>
    </div>

    <div class="form-row" *ngIf="currentAttendance.status === 'Present'">
      <div class="form-group">
        <label for="checkInTime">Check-In Time</label>
        <input
          type="datetime-local"
          id="checkInTime"
          [(ngModel)]="currentAttendance.checkInTime"
          name="checkInTime"
          required
        />
      </div>

      <div class="form-group">
        <label for="checkOutTime">Check-Out Time</label>
        <input
          type="datetime-local"
          id="checkOutTime"
          [(ngModel)]="currentAttendance.checkOutTime"
          name="checkOutTime"
          required
        />
      </div>
    </div>

    <div *ngIf="currentAttendance.status !== 'Present' && currentAttendance.status">
      <small class="info-text">
        â›” Check-in and Check-out not required for "{{ currentAttendance.status }}".
      </small>
    </div>

    <div class="form-group">
      <label for="remarks">Remarks</label>
      <input
        type="text"
        id="remarks"
        [(ngModel)]="currentAttendance.remarks"
        name="remarks"
        placeholder=" remarks"
      />
    </div>

    <div class="form-group">
      <label for = "date">Date</label>
      <input 
      type="date"
      id="date"
      [(ngModel)] = "currentAttendance.date"
      name="Date"
      required/>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        {{ isEditing ? 'Update Attendance' : 'Add Attendance' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="resetForm()">
        Clear
      </button>
    </div>
  </form>

  <hr />

  <h3>Attendance Records</h3>
  <table class="attendance-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Employee ID</th>
        <th>Status</th>
        <th>Check-In</th>
        <th>Check-Out</th>
        <th>Remarks</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let record of att">
        <td>{{ record.attendanceId }}</td>
        <td>{{ record.employeeId }}</td>
        <td>{{ record.status }}</td>
        <td>{{ record.checkInTime ? (record.checkInTime | date: 'short') : '-' }}</td>
        <td>{{ record.checkOutTime ? (record.checkOutTime | date: 'short') : '-' }}</td>
        <td>{{ record.remarks }}</td>
        <td>{{record.date  | date:'mediumDate'}}</td>
        <td>
          <button (click)="updateAttendance(record)" class="btn btn-warning">
            Edit
          </button>
          <button
            (click)="deleteAttendance(record.attendanceId)"
            class="btn btn-danger"
          >
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
